<!DOCTYPE html>
<html lang="zxx">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>🍵</title>
  <style>
    body {
      background-color: #111;
      color: white;
      font-family: sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      margin: 0;
      transition: background-color 0.3s, color 0.3s;
    }

    .emoji {
      font-size: 4rem;
      margin-bottom: 20px;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: center;
    }

    button {
      background: #333;
      color: white;
      border: 1px solid transparent;
      padding: 10px 20px;
      margin: 5px;
      font-size: 1rem;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.3s, color 0.3s, border-color 0.3s;
      touch-action: manipulation;
    }

    button:hover {
      background: #555;
    }

    svg {
      width: 1.5em;
      height: 1.5em;
      fill: currentColor;
    }

    /* --- light mode --- */
    @media (prefers-color-scheme: light) {
      body {
        background-color: #f4f4f4;
        color: #222;
      }

      button {
        background: #e0e0e0;
        color: #222;
        border-color: #ccc;
      }

      button:hover {
        background: #c7c7c7;
      }
    }
  </style>
</head>

<body>
  <div class="emoji" id="emojiDisplay">🍵</div>
  <div>
    <button onclick="handleClick('today')">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">
        <path
          d="M128 0c17.7 0 32 14.3 32 32l0 32 128 0 0-32c0-17.7 14.3-32 32-32s32 14.3 32 32l0 32 32 0c35.3 0 64 28.7 64 64l0 288c0 35.3-28.7 64-64 64L64 480c-35.3 0-64-28.7-64-64L0 128C0 92.7 28.7 64 64 64l32 0 0-32c0-17.7 14.3-32 32-32zm0 256c-17.7 0-32 14.3-32 32l0 64c0 17.7 14.3 32 32 32l64 0c17.7 0 32-14.3 32-32l0-64c0-17.7-14.3-32-32-32l-64 0z" />
      </svg>
    </button>
    <button onclick="handleClick('any')">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
        <path
          d="M403.8 34.4c12-5 25.7-2.2 34.9 6.9l64 64c6 6 9.4 14.1 9.4 22.6s-3.4 16.6-9.4 22.6l-64 64c-9.2 9.2-22.9 11.9-34.9 6.9S384 204.9 384 192l0-32-32 0c-10.1 0-19.6 4.7-25.6 12.8l-32.4 43.2-40-53.3 21.2-28.3C293.3 110.2 321.8 96 352 96l32 0 0-32c0-12.9 7.8-24.6 19.8-29.6zM154 296l40 53.3-21.2 28.3C154.7 401.8 126.2 416 96 416l-64 0c-17.7 0-32-14.3-32-32s14.3-32 32-32l64 0c10.1 0 19.6-4.7 25.6-12.8L154 296zM438.6 470.6c-9.2 9.2-22.9 11.9-34.9 6.9S384 460.9 384 448l0-32-32 0c-30.2 0-58.7-14.2-76.8-38.4L121.6 172.8c-6-8.1-15.5-12.8-25.6-12.8l-64 0c-17.7 0-32-14.3-32-32S14.3 96 32 96l64 0c30.2 0 58.7 14.2 76.8 38.4L326.4 339.2c6 8.1 15.5 12.8 25.6 12.8l32 0 0-32c0-12.9 7.8-24.6 19.8-29.6s25.7-2.2 34.9 6.9l64 64c6 6 9.4 14.1 9.4 22.6s-3.4 16.6-9.4 22.6l-64 64z" />
      </svg>
    </button>
  </div>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/seedrandom/3.0.5/seedrandom.min.js"></script>
  <script>
    const emojiData = {
      "Smiley": {
        "Smiling & Affectionate": ["😀", "😃", "😄", "😁", "😆", "😅", "🤣", "😂", "🙂", "😉", "😊", "😇", "🥰", "😍", "🤩", "😘", "😗", "☺️", "😚", "😙", "🥲", "😏"],
        "Tongues, Hands & Accessories": ["😋", "😛", "😜", "🤪", "😝", "🤑", "🤗", "🤭", "🫢", "🫣", "🤫", "🤔", "🫡", "🤤", "🤠", "🥳", "🥸", "😎", "🤓", "🧐"],
        "Neutral & Skeptical": ["🙃", "🫠", "🤐", "🤨", "😐", "😑", "😶", "🫥", "😶‍🌫️", "😒", "🙄", "😬", "😮‍💨", "🤥", "🫨", "🙂‍↔️", "🙂‍↕️"],
        "Sleepy & Unwell": ["😌", "😔", "😪", "😴", "🫩", "😷", "🤒", "🤕", "🤢", "🤮", "🤧", "🥵", "🥶", "🥴", "😵", "😵‍💫", "🤯", "🥱"],
        "Concerned & Negative": ["😕", "🫤", "😟", "🙁", "☹️", "😮", "😯", "😲", "😳", "🥺", "🥹", "😦", "😧", "😨", "😰", "😥", "😢", "😭", "😱", "😖", "😣", "😞", "😓", "😩", "😫", "😤", "😡", "😠", "🤬"],
        "Costume, Creature & Animal": ["😈", "👿", "💀", "☠️", "💩", "🤡", "👹", "👺", "👻", "👽", "👾", "🤖", "😺", "😸", "😹", "😻", "😼", "😽", "🙀", "😿", "😾", "🙈", "🙉", "🙊"]
      },
      "Animals & Nature": {
        "Mammals & Marsupials": ["🐵", "🐒", "🦍", "🦧", "🐶", "🐕", "🦮", "🐕‍🦺", "🐩", "🐺", "🦊", "🦝", "🐱", "🐈", "🐈‍⬛", "🦁", "🐯", "🐅", "🐆", "🐴", "🫎", "🫏", "🐎", "🦄", "🦓", "🦌", "🦬", "🐮", "🐂", "🐃", "🐄", "🐷", "🐖", "🐗", "🐽", "🐏", "🐑", "🐐", "🐪", "🐫", "🦙", "🦒", "🐘", "🦣", "🦏", "🦛", "🐭", "🐁", "🐀", "🐹", "🐰", "🐇", "🐿️", "🦫", "🦔", "🦇", "🐻", "🐻‍❄️", "🐨", "🐼", "🦥", "🦦", "🦨", "🦘", "🦡", "🐾"],
        "Birds": ["🦃", "🐔", "🐓", "🐣", "🐤", "🐥", "🐦", "🐧", "🕊️", "🦅", "🦆", "🦢", "🦉", "🦤", "🪶", "🦩", "🦚", "🦜", "🪽", "🐦‍⬛", "🪿", "🐦‍🔥", "🪹", "🪺"],
        "Marine & Reptiles": ["🐸", "🐊", "🐢", "🦎", "🐍", "🐲", "🐉", "🦕", "🦖", "🐳", "🐋", "🐬", "🦭", "🐟", "🐠", "🐡", "🦈", "🐙", "🐚", "🪸", "🪼", "🦀", "🦞", "🦐", "🦑", "🦪"],
        "Bugs": ["🐌", "🦋", "🐛", "🐜", "🐝", "🪲", "🐞", "🦗", "🪳", "🕷️", "🕸️", "🦂", "🦟", "🪰", "🪱", "🦠"],
        "Plants, Flowers & Nature": ["💐", "🌸", "💮", "🪷", "🏵️", "🌹", "🥀", "🌺", "🌻", "🌼", "🌷", "🪻", "🌱", "🪴", "🌲", "🌳", "🪾", "🌴", "🌵", "🌾", "🌿", "☘️", "🍀", "🍁", "🍂", "🍃", "🍄", "🪨", "🪵"],
        "Sky & Weather": ["🌑", "🌒", "🌓", "🌔", "🌕", "🌖", "🌗", "🌘", "🌙", "🌚", "🌛", "🌜", "☀️", "🌝", "🌞", "🪐", "⭐", "🌟", "🌠", "🌌", "☁️", "⛅", "⛈️", "🌤️", "🌥️", "🌦️", "🌧️", "🌨️", "🌩️", "🌪️", "🌫️", "🌬️", "🌀", "🌈", "🌂", "☂️", "☔", "⛱️", "⚡", "❄️", "☃️", "⛄", "☄️", "🔥", "💧", "🌊"]
      },
      "Food & Drink": {
        "Fruits": ["🍇", "🍈", "🍉", "🍊", "🍋", "🍋‍🟩", "🍌", "🍍", "🥭", "🍎", "🍏", "🍐", "🍑", "🍒", "🍓", "🫐", "🥝", "🍅", "🫒", "🥥"],
        "Vegetables": ["🥑", "🍆", "🥔", "🥕", "🌽", "🌶️", "🫑", "🥒", "🥬", "🥦", "🧄", "🧅", "🥜", "🫘", "🌰", "🫚", "🫛", "🫜", "🍄‍🟫"],
        "Prepared Foods": ["🍞", "🥐", "🥖", "🫓", "🥨", "🥯", "🥞", "🧇", "🧀", "🍖", "🍗", "🥩", "🥓", "🍔", "🍟", "🍕", "🌭", "🥪", "🌮", "🌯", "🫔", "🥙", "🧆", "🥚", "🍳", "🥘", "🍲", "🫕", "🥣", "🥗", "🍿", "🧈", "🧂", "🥫", "🍝"],
        "Asian Foods": ["🍱", "🍘", "🍙", "🍚", "🍛", "🍜", "🍠", "🍢", "🍣", "🍤", "🍥", "🥮", "🍡", "🥟", "🥠", "🥡"],
        "Sweets & Desserts": ["🍦", "🍧", "🍨", "🍩", "🍪", "🎂", "🍰", "🧁", "🥧", "🍫", "🍬", "🍭", "🍮", "🍯"],
        "Drinks & Dishware": ["🍼", "🥛", "☕", "🫖", "🍵", "🍶", "🍾", "🍷", "🍸", "🍹", "🍺", "🍻", "🥂", "🥃", "🫗", "🥤", "🧋", "🧃", "🧉", "🥢", "🍽️", "🍴", "🥄", "🔪", "🫙", "🏺"]
      },
      "Activity": {
        "Events & Celebrations": ["🎃", "🎄", "🎆", "🎇", "🧨", "✨", "🎈", "🎉", "🎊", "🎋", "🎍", "🎎", "🎏", "🎐", "🎑", "🧧", "🎁", "🎟️", "🎫", "🏮", "🪔"],
        "Sports & Awards": ["🎖️", "🏆", "🏅", "🥇", "🥈", "🥉", "⚽", "⚾", "🥎", "🏀", "🏐", "🏈", "🏉", "🎾", "🥏", "🎳", "🏏", "🏑", "🏒", "🥍", "🏓", "🏸", "🥊", "🥋", "🥅", "⛳", "⛸️", "🎣", "🤿", "🎽", "🎿", "🛷", "🥌", "🎯"],
        "Games & Culture": ["🪀", "🪁", "🔫", "🎱", "🔮", "🪄", "🎮", "🕹️", "🎰", "🎲", "🧩", "🪅", "🪩", "🪆", "♠️", "♥️", "♦️", "♣️", "♟️", "🃏", "🀄", "🎴", "🎭", "🖼️", "🎨"]
      },
      "Travel & Places": {
        "Maps & Geography": ["🌍", "🌎", "🌏", "🌐", "🗺️", "🗾", "🧭", "🏔️", "⛰️", "🌋", "🗻", "🏕️", "🏖️", "🏜️", "🏝️", "🏞️"],
        "Buildings & Places": ["🏟️", "🏛️", "🏗️", "🧱", "🛖", "🏘️", "🏚️", "🏠", "🏡", "🏢", "🏣", "🏤", "🏥", "🏦", "🏨", "🏩", "🏪", "🏫", "🏬", "🏭", "🏯", "🏰", "💒", "🗼", "🗽", "⛪", "🕌", "🛕", "🕍", "⛩️", "🕋", "⛲", "⛺", "🌁", "🌃", "🏙️", "🌄", "🌅", "🌆", "🌇", "🌉", "♨️", "🎠", "🛝", "🎡", "🎢", "💈", "🎪", "🛎️", "🗿"],
        "Land Travel": ["🚂", "🚃", "🚄", "🚅", "🚆", "🚇", "🚈", "🚉", "🚊", "🚝", "🚞", "🚋", "🚌", "🚍", "🚎", "🚐", "🚑", "🚒", "🚓", "🚔", "🚕", "🚖", "🚗", "🚘", "🚙", "🛻", "🚚", "🚛", "🚜", "🏎️", "🏍️", "🛵", "🦽", "🦼", "🛺", "🚲", "🛴", "🛹", "🛼", "🚏", "🛣️", "🛤️", "🛢️", "⛽", "🛞", "🚨", "🚥", "🚦", "🛑", "🚧"],
        "Air & Sea Travel": ["⚓", "🛟", "⛵", "🛶", "🚤", "🛳️", "⛴️", "🛥️", "🚢", "✈️", "🛩️", "🛫", "🛬", "🪂", "💺", "🚁", "🚟", "🚠", "🚡", "🛰️", "🚀", "🛸"]
      },
      "Object Emoji": {
        "Clothing & Appearance": ["🎀", "🎗️", "👓", "🕶️", "🥽", "🥼", "🦺", "👔", "👕", "👖", "🧣", "🧤", "🧥", "🧦", "👗", "👘", "🥻", "🩱", "🩲", "🩳", "👙", "👚", "🪭", "👛", "👜", "👝", "🛍️", "🎒", "🩴", "👞", "👟", "🥾", "🥿", "👠", "👡", "🩰", "👢", "🪮", "👑", "👒", "🎩", "🎓", "🧢", "🪖", "⛑️", "📿", "💄", "💍", "💎", "🦯", "🧿"],
        "Music & Sound": ["🔇", "🔈", "🔉", "🔊", "📢", "📣", "📯", "🔔", "🔕", "🎼", "🎵", "🎶", "🎙️", "🎚️", "🎛️", "🎤", "🎧", "📻", "🎷", "🪗", "🎸", "🎹", "🎺", "🎻", "🪕", "🥁", "🪘", "🪇", "🪈", "🪉"],
        "IT & AV": ["📱", "📲", "☎️", "📞", "📟", "📠", "🔋", "🪫", "🔌", "💻", "🖥️", "🖨️", "⌨️", "🖱️", "🖲️", "💽", "💾", "💿", "📀", "🎥", "🎞️", "📽️", "🎬", "📺", "📷", "📸", "📹", "📼"],
        "Office & Stationery": ["📔", "📕", "📖", "📗", "📘", "📙", "📚", "📓", "📒", "📃", "📜", "📄", "📰", "🗞️", "📑", "🔖", "🏷️", "✉️", "📧", "📨", "📩", "📤", "📥", "📦", "📫", "📪", "📬", "📭", "📮", "🗳️", "✏️", "✒️", "🖋️", "🖊️", "🖌️", "🖍️", "📝", "💼", "📁", "📂", "🗂️", "📅", "📆", "🗒️", "🗓️", "📇", "📈", "📉", "📊", "📋", "📌", "📍", "📎", "🖇️", "📏", "📐", "✂️", "🗃️", "🗄️", "🗑️", "🪪"],
        "Money & Time": ["⌛", "⏳", "⌚", "⏰", "⏱️", "⏲️", "🕰️", "🕛", "🕧", "🕐", "🕜", "🕑", "🕝", "🕒", "🕞", "🕓", "🕟", "🕔", "🕠", "🕕", "🕡", "🕖", "🕢", "🕗", "🕣", "🕘", "🕤", "🕙", "🕥", "🕚", "🕦", "🧮", "💰", "🪙", "💴", "💵", "💶", "💷", "💸", "💳", "🧾", "💹"],
        "Tools, Household Items & Other": ["🧳", "🌡️", "🧸", "🧶", "🪢", "🔍", "🔎", "🕯️", "💡", "🔦", "🔒", "🔓", "🔏", "🔐", "🔑", "🗝️", "🔨", "🪓", "⛏️", "⚒️", "🛠️", "🗡️", "⚔️", "💣", "🪃", "🏹", "🛡️", "🪚", "🔧", "🪛", "🔩", "⚙️", "🗜️", "⚖️", "🔗", "⛓️‍💥", "⛓️", "🪝", "🧰", "🧲", "🪜", "🪏", "⚗️", "🧪", "🧫", "🔬", "🔭", "📡", "💉", "🩹", "🩼", "🩺", "🩻", "🚪", "🪞", "🪟", "🛏️", "🛋️", "🪑", "🚽", "🪠", "🚿", "🛁", "🪤", "🪒", "🧴", "🧷", "🧹", "🧺", "🧻", "🪣", "🧼", "🫧", "🪥", "🧽", "🧯", "🛒", "🚬", "⚰️", "🪦", "⚱️", "🪧"]
      }
    };

    const emojiWeights = {
      "Smiley": {
        "total": 0.1,
        "Smiling & Affectionate": 0.25,
        "Tongues, Hands & Accessories": 0.1,
        "Neutral & Skeptical": 0.2,
        "Sleepy & Unwell": 0.15,
        "Concerned & Negative": 0.2,
        "Costume, Creature & Animal": 0.1
      },
      "Animals & Nature": {
        "total": 0.3,
        "Mammals & Marsupials": 0.13,
        "Birds": 0.15,
        "Marine & Reptiles": 0.12,
        "Bugs": 0.1,
        "Plants, Flowers & Nature": 0.3,
        "Sky & Weather": 0.2
      },
      "Food & Drink": {
        "total": 0.3,
        "Fruits": 0.2,
        "Vegetables": 0.2,
        "Prepared Foods": 0.2,
        "Asian Foods": 0.1,
        "Sweets & Desserts": 0.1,
        "Drinks & Dishware": 0.2
      },
      "Activity": {
        "total": 0.1,
        "Events & Celebrations": 0.6,
        "Sports & Awards": 0.2,
        "Games & Culture": 0.2
      },
      "Travel & Places": {
        "total": 0.15,
        "Maps & Geography": 0.2,
        "Buildings & Places": 0.3,
        "Land Travel": 0.3,
        "Air & Sea Travel": 0.2
      },
      "Object Emoji": {
        "total": 0.05,
        "Clothing & Appearance": 0.25,
        "Music & Sound": 0.1,
        "IT & AV": 0.1,
        "Office & Stationery": 0.2,
        "Money & Time": 0.1,
        "Tools, Household Items & Other": 0.25
      }
    };

    const CLICK_TIMEOUT = 300;
    let currentCategory = null;
    let currentSubCategory = null;
    let clickCount = 0;
    let lastClickTime = 0;
    let lastMode = '';
    let todayEmojiCache = [];

    // choose key by weighted random
    function weightedRandom(weightObj, seed = null) {
      const weightRnd = new Math.seedrandom(seed);
      const entries = Object.entries(weightObj).filter(([k]) => k !== "total");
      let totalWeight = entries.reduce((sum, [, w]) => sum + w, 0);
      let rnd = weightRnd() * totalWeight;
      for (let [key, weight] of entries) {
        rnd -= weight;
        if (rnd <= 0) return key;
      }
    }

    // get a random emoji from an array
    function randomFromArray(arr, seed = null) {
      if (!arr || arr.length === 0) return '';
      const rnd = new Math.seedrandom(seed);
      return arr[Math.floor(rnd() * arr.length)];
    }

    // main draw function
    let drawCount = 0;
    function drawEmoji(seed = null) {
      const emojiRnd = new Math.seedrandom(seed);
      const now = Date.now();
      // judge if timeout
      if (now - lastClickTime > CLICK_TIMEOUT) {
        drawCount = 0;
        currentCategory = null;
      }
      drawCount++;
      lastClickTime = now;
      let chosenCategory;
      let chosenSubCategory;
      // first click: choose a random category and subcategory
      if (drawCount === 1 || !currentCategory) {
        chosenCategory = weightedRandom(
          Object.fromEntries(
            Object.entries(emojiWeights).map(([cat, obj]) => [cat, obj.total])
          ), seed
        );
        chosenSubCategory = weightedRandom(emojiWeights[chosenCategory], seed);
      } else {
        // continuous clicks: choose from the same category or a different one
        const diffProb = Math.pow(0.36, drawCount - 1);
        if (emojiRnd() < diffProb || currentCategory === 'Smiley') {
          // different category
          const otherCats = Object.keys(emojiWeights).filter(c => c !== currentCategory);
          const otherWeights = Object.fromEntries(otherCats.map(cat => [cat, emojiWeights[cat].total]));
          chosenCategory = weightedRandom(otherWeights, seed);
          chosenSubCategory = weightedRandom(emojiWeights[chosenCategory], seed);
        } else {
          // same category
          chosenCategory = currentCategory;
          // choose subcategory
          if (emojiRnd() < 0.5) {
            chosenSubCategory = weightedRandom(emojiWeights[chosenCategory], seed);
          } else {
            chosenSubCategory = currentSubCategory || weightedRandom(emojiWeights[chosenCategory], seed);
          }
        }
      }
      // choose emoji
      const emoji = randomFromArray(emojiData[chosenCategory][chosenSubCategory], seed);
      // avoid duplicates
      const container = document.getElementById("emojiDisplay");
      const currentEmojis = Array.from(container.children).map(e => e.textContent);
      if (currentEmojis.includes(emoji)) {
        // if already exists, try again
        return drawEmoji(seed);
      }
      // update current category and subcategory
      currentCategory = chosenCategory;
      currentSubCategory = chosenSubCategory;
      return emoji;
    }

    function handleClick(mode) {
      const now = Date.now();
      if (mode !== lastMode || now - lastClickTime > CLICK_TIMEOUT) {
        clickCount = 0;
        document.getElementById("emojiDisplay").textContent = '';
      }
      lastMode = mode;

      const container = document.getElementById("emojiDisplay");
      const currentEmojis = Array.from(container.children).map(e => e.textContent);

      if (mode === 'today') {
        clickCount = Math.min(clickCount + 1, 3);
        if (todayEmojiCache.length === 0) {
          const today = new Date();
          const seed = today.getFullYear() * 10000 + (today.getMonth() + 1) * 100 + today.getDate();
          const seedVariantRnd = new Math.seedrandom(seed);
          const offset = Math.floor(seedVariantRnd() * 100000000);
          const seed2 = seed + offset;
          const seed3 = seed + offset * 2;
          todayEmojiCache.push(drawEmoji(seed));
          todayEmojiCache.push(drawEmoji(seed2));
          todayEmojiCache.push(drawEmoji(seed3));
        }
        displayEmojis(todayEmojiCache.slice(0, clickCount));
      } else if (mode === 'any') {
        if (currentEmojis.length >= 3) return;
        const emoji = drawEmoji();
        appendEmoji(emoji);
        clickCount = currentEmojis.length + 1;
      }
      // update title
      let children = container.childNodes;
      let displayedEmojis = Array.from(children).map(e => e.textContent);
      if (displayedEmojis.length > 0) {
        document.title = displayedEmojis;
      }
      lastClickTime = now;
    }

    function displayEmojis(list) {
      const container = document.getElementById("emojiDisplay");
      container.innerHTML = '';
      list.forEach(e => {
        const span = document.createElement('span');
        span.textContent = e;
        container.appendChild(span);
      });
    }

    function appendEmoji(e) {
      const container = document.getElementById("emojiDisplay");
      const span = document.createElement('span');
      span.textContent = e;
      container.appendChild(span);
    }

    handleClick('today');
  </script>
</body>

</html>